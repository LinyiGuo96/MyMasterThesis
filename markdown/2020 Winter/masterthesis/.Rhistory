load("C:/Users/guoly/Desktop/markdown/2020 Winter/masterthesis/.RData")
load("C:/Users/guoly/Desktop/markdown/2020 Winter/masterthesis/idemat1.RData")
mlemat_simlist <- t(sapply(simlist, mle_extract))
library(seasonal)
library(KFAS)
mlemat_simlist <- t(sapply(simlist, mle_extract))
loss <- function(data, x11, kfs){
deseasonal_x11 <- series(x11, "d11")
trend_x11 <- series(x11, "d12")
deseasonal_kfs <- data - signal(kfs, "seasonal")$signal
trend_kfs <- signal(kfs, "trend")$signal
l <- sum((deseasonal_x11-deseasonal_kfs)^2) + sum((diff(trend_x11)-diff(trend_kfs))^2)
return(l)
}
loss2 <- function(data, x11, kfs){
deseasonal_x11 <- series(x11, "d11")
trend_x11 <- series(x11, "d12")
deseasonal_kfs <- data - signal(kfs, "seasonal")$signal
trend_kfs <- signal(kfs, "trend")$signal
l <- sum((deseasonal_x11-deseasonal_kfs)^2) + sum((trend_x11-trend_kfs)^2)
return(l)
}
loss3 <- function(x11, kfs){
trend_x11 <- series(x11, "d12")
seasonal_x11 <- series(x11, "d10")
trend_kfs <- signal(kfs, "trend")$signal
seasonal_kfs <- signal(kfs, "seasonal")$signal
l <- sum((seasonal_x11-seasonal_kfs)^2) + sum((trend_x11-trend_kfs)^2)
return(l)
}
loss4 <- function(x11, kfs){
seasonal_x11 <- series(x11, "d10")
trend_x11 <- series(x11, "d12")
seasonal_kfs <- signal(kfs, "seasonal")$signal
trend_kfs <- signal(kfs, "trend")$signal
l <- sum((seasonal_x11-seasonal_kfs)^2) + sum((diff(trend_x11)-diff(trend_kfs))^2)
return(l)
}
loss5 <- function(x11, kfs){
seasonal_x11 <- series(x11, "d10")
trend_x11 <- series(x11, "d12")
seasonal_kfs <- signal(kfs, "seasonal")$signal
trend_kfs <- signal(kfs, "trend")$signal
l <- sum((seasonal_x11-seasonal_kfs)^2) + sum((trend_x11-trend_kfs)^2) + sum((diff(trend_x11)-diff(trend_kfs))^2)
return(l)
}
loss6 <- function(x11, kfs){
seasonal_x11 <- series(x11, "d10")
trend_x11 <- series(x11, "d12")
seasonal_kfs <- signal(kfs, "seasonal")$signal
trend_kfs <- signal(kfs, "trend")$signal
l <- sum((seasonal_x11-seasonal_kfs)^2) + sum((trend_x11-trend_kfs)^2) + (sum(diff(trend_x11)) - sum(diff(trend_kfs)))^2
return(l)
}
gridsearch <- function(data) {
x11 <- seas(data, x11='')
loss6mat  <- foreach (i = 1:200, .combine = "rbind", .packages = c("KFAS","seasonal")) %:%
foreach(j = 1:200, .combine = "rbind") %dopar% {
ssm <- SSModel(data ~ SSMtrend(1, Q=list(j*0.1)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=i*0.1)
kfs <- KFS(ssm)
l <- loss6(x11, kfs)
c(i*0.1, j*0.1, l)
}
return(loss6mat[which.min(loss6mat[,3]),c(1,2)])
}
mle_extract <- function(data) {
# note the output is actually the ratio of mle
ssm <- SSModel(data ~ SSMtrend(1, Q=list(NA)) +SSMseasonal(12, sea.type = "dummy", Q=NA), H=NA)
fit <- fitSSM(ssm, inits = c(1,1,1))
kfs <- KFS(fit$model)
var_I <- fit$model["H"][1,1,1]
var_T <- fit$model["Q"][1,1,1]
var_S <- fit$model["Q"][2,2,1]
return(c(var_I/var_S, var_T/var_S))
}
mlemat_simlist <- t(sapply(simlist, mle_extract))
plot(mlemat_simlist[,1])
plot(density(mlemat_simlist[,1]))
plot(density(mlemat_simlist[,2]))
plot(density(idemat1[,1]))
plot(density(idemat1[,2]))
plot(density(mlemat_simlist[,2]))
plot(density(mlemat_simlist[,1]))
plot(density(idemat1[,1]))
plot(density(idemat1[,1]))
plot(density(mlemat_simlist[,1]), xlim=c(0,50), ylim=c(0,0.2))
plot(density(mlemat_simlist[,1]), xlim=c(0,50), ylim=c(0,0.15))
plot(density(mlemat_simlist[,1]), xlim=c(0,50), ylim=c(0,0.15), main='', xlab='')
plot(density(idemat1[,1]), xlim=c(0,50), ylim=c(0,0.15), main='', xlab='')
plot(density(mlemat_simlist[,1]), xlim=c(0,50), ylim=c(0,0.15), main='', xlab='')
par(new=TRUE)
plot(density(idemat1[,1]), xlim=c(0,50), ylim=c(0,0.15), main='', xlab='', col=2)
plot(density(mlemat_simlist[,2]))
View(mle_extract)
plot(density(mlemat_simlist[,2]), xlim=c(0,40), ylim=c(0,0.2), main='', xlab='')
par(new=TRUE)
plot(density(idemat1[,2]), xlim=c(0,40), ylim=c(0,0.2), main='', xlab='')
plot(density(idemat1[,2]), xlim=c(0,40), ylim=c(0,0.2), main='', xlab='')
plot(density(mlemat_simlist[,2]), xlim=c(0,40), ylim=c(0,0.5), main='', xlab='')
par(new=TRUE)
plot(density(idemat1[,2]), xlim=c(0,40), ylim=c(0,0.5), main='', xlab='')
plot(density(mlemat_simlist[,2]), xlim=c(0,40), ylim=c(0,0.4), main='', xlab='')
par(new=TRUE)
plot(density(idemat1[,2]), xlim=c(0,40), ylim=c(0,0.4), main='', xlab='', col=2)
plot(density(mlemat_simlist[,1]), xlim=c(0,50), ylim=c(0,0.15), main='', xlab='')
par(new=TRUE)
plot(density(idemat1[,1]), xlim=c(0,50), ylim=c(0,0.15), main='', xlab='', col=2)
plot(density(mlemat_simlist[,2]), xlim=c(0,40), ylim=c(0,0.4), main='', xlab='')
par(new=TRUE)
plot(density(idemat1[,2]), xlim=c(0,40), ylim=c(0,0.4), main='', xlab='', col=2)
plot(density(mlemat_simlist[,1]), xlim=c(0,50), ylim=c(0,0.15), main='', xlab='')
par(new=TRUE)
plot(density(idemat1[,1]), xlim=c(0,50), ylim=c(0,0.15), main='', xlab='', col=2)
load("C:/Users/guoly/Desktop/markdown/2020 Winter/BuildThePrior/.RData")
str(Idevalmat)
plot(density(Idevalmat[,1]))
plot(density(Idevalmat[,2]))
plot(density(Idevalmat[,3]))
plot(density(Idevalmat[,2]))
plot(density(Idevalmat[,3]))
plot(density(Idevalmat[,2]))
plot(density(Idevalmat[,3]))
plot(density(Idevalmat[,2]))
plot(density(Idevalmat[,3]))
##### posterior #####
library(doParallel)
View(gridsearch)
```{r, fig.asp=0.33, echo=FALSE}
library(seasonal)
library(KFAS)
unemp_x11 <- seas(unemp, x11='')
par(mfrow=c(1,3))
plot(unemp,ylab='')
plot(series(unemp_x11, 'd11'),ylab='')
plot(series(unemp_x11, 'd12'),ylab='')
par(mfrow=c(1,1))
library(seasonal)
library(KFAS)
unemp_x11 <- seas(unemp, x11='')
par(mfrow=c(3,1))
plot(unemp,ylab='')
plot(series(unemp_x11, 'd11'),ylab='')
plot(series(unemp_x11, 'd12'),ylab='')
par(mfrow=c(1,1))
library(seasonal)
library(KFAS)
unemp_x11 <- seas(unemp, x11='')
par(mfrow=c(3,1))
plot(unemp,ylab='')
plot(series(unemp_x11, 'd11'),ylab='')
plot(series(unemp_x11, 'd12'),ylab='')
par(mfrow=c(1,1))
library(seasonal)
library(KFAS)
unemp_x11 <- seas(unemp, x11='')
par(mfrow=c(3,1))
plot(unemp,ylab='')
plot(series(unemp_x11, 'd11'),ylab='')
plot(series(unemp_x11, 'd12'),ylab='')
par(mfrow=c(1,1))
library(seasonal)
library(KFAS)
unemp_x11 <- seas(unemp, x11='')
par(mfrow=c(3,1))
plot(unemp,ylab='')
plot(series(unemp_x11, 'd11'),ylab='')
plot(series(unemp_x11, 'd12'),ylab='')
par(mfrow=c(1,1))
library(seasonal)
library(KFAS)
unemp_x11 <- seas(unemp, x11='')
par(mfrow=c(2,2))
plot(unemp,ylab='')
plot(series(unemp_x11, 'd11'),ylab='')
plot(series(unemp_x11, 'd12'),ylab='')
plot(series(unemp_x11, 'd10'),ylab='')
par(mfrow=c(1,1))
library(seasonal)
library(KFAS)
unemp_x11 <- seas(unemp, x11='')
par(mfrow=c(2,2))
plot(unemp,ylab='')
plot(series(unemp_x11, 'd11'),ylab='')
plot(series(unemp_x11, 'd12'),ylab='')
plot(series(unemp_x11, 'd10'),ylab='')
par(mfrow=c(1,1))
library(seasonal)
library(KFAS)
unemp_x11 <- seas(unemp, x11='')
par(mfrow=c(2,2))
plot(unemp,ylab='')
plot(series(unemp_x11, 'd11'),ylab='')
plot(series(unemp_x11, 'd12'),ylab='')
plot(series(unemp_x11, 'd10'),ylab='')
par(mfrow=c(1,1))
unemp_ssm0 <- SSModel(unemp ~ SSMtrend(1, Q=list(NA)) + SSMseasonal(12, sea.type = 'dummy', Q=NA), H=NA)
unemp_fit0 <- fitSSM(unemp_ssm0, inits=c(1,1,1))
unemp_kfs0 <- KFS(unemp_fit0$model)
unemp_ssm6 <- SSModel(unemp ~ SSMtrend(1, Q=list(1.5)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=2)
unemp_kfs6 <- KFS(unemp_ssm6)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=2)
par(new=TRUE)
plot(signal(unemp_kfs6, "trend")$signal, ylim=c(5500, 15500), ylab='',col=4, lwd=2)
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=2, lwd=2)
unemp_ssm0 <- SSModel(unemp ~ SSMtrend(1, Q=list(NA)) + SSMseasonal(12, sea.type = 'dummy', Q=NA), H=NA)
unemp_fit0 <- fitSSM(unemp_ssm0, inits=c(1,1,1))
unemp_kfs0 <- KFS(unemp_fit0$model)
unemp_ssm6 <- SSModel(unemp ~ SSMtrend(1, Q=list(1.5)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=2)
unemp_kfs6 <- KFS(unemp_ssm6)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=2)
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=2, lwd=2)
par(new=TRUE)
plot(signal(unemp_kfs6, "trend")$signal, ylim=c(5500, 15500), ylab='',col=4, lwd=2)
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
unemp_ssm0 <- SSModel(unemp ~ SSMtrend(1, Q=list(NA)) + SSMseasonal(12, sea.type = 'dummy', Q=NA), H=NA)
unemp_fit0 <- fitSSM(unemp_ssm0, inits=c(1,1,1))
unemp_kfs0 <- KFS(unemp_fit0$model)
unemp_ssm6 <- SSModel(unemp ~ SSMtrend(1, Q=list(1.5)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=2)
unemp_kfs6 <- KFS(unemp_ssm6)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=1)
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=2, lwd=1)
par(new=TRUE)
plot(signal(unemp_kfs6, "trend")$signal, ylim=c(5500, 15500), ylab='',col=4, lwd=1)
title(main='trend')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
unemp_ssm0 <- SSModel(unemp ~ SSMtrend(1, Q=list(NA)) + SSMseasonal(12, sea.type = 'dummy', Q=NA), H=NA)
unemp_fit0 <- fitSSM(unemp_ssm0, inits=c(1,1,1))
unemp_kfs0 <- KFS(unemp_fit0$model)
unemp_ssm6 <- SSModel(unemp ~ SSMtrend(1, Q=list(1.5)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=2)
unemp_kfs6 <- KFS(unemp_ssm6)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=1)
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=2, lwd=1)
par(new=TRUE)
plot(signal(unemp_kfs6, "trend")$signal, ylim=c(5500, 15500), ylab='',col=4, lwd=1)
title(main='trend')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
plot(series(unemp_x11, "d11"), ylim=c(5500, 15500), ylab='', lwd=1)
par(new=TRUE)
plot(unemp - signal(unemp_kfs0, "seasonal")$signal, ylab='', lwd=1, col=2, ylim=c(5500, 15500))
par(new=TRUE)
plot(unemp - signal(unemp_kfs6, "seasonal")$signal, ylab='', lwd=1, col=4, ylim=c(5500, 15500))
title(main='Seasonal adjusted')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=1, alpha=c(1,.5))
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha(2,.5), lwd=1)
library(scales)
unemp_ssm0 <- SSModel(unemp ~ SSMtrend(1, Q=list(NA)) + SSMseasonal(12, sea.type = 'dummy', Q=NA), H=NA)
unemp_fit0 <- fitSSM(unemp_ssm0, inits=c(1,1,1))
unemp_kfs0 <- KFS(unemp_fit0$model)
unemp_ssm6 <- SSModel(unemp ~ SSMtrend(1, Q=list(1.5)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=2)
unemp_kfs6 <- KFS(unemp_ssm6)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=1, alpha=c(1,.5))
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha(2,.5), lwd=1)
par(new=TRUE)
plot(signal(unemp_kfs6, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha(4,.5), lwd=1)
title(main='trend')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
plot(series(unemp_x11, "d11"), ylim=c(5500, 15500), ylab='', lwd=1, col=alpha(1,.5))
par(new=TRUE)
plot(unemp - signal(unemp_kfs0, "seasonal")$signal, ylab='', lwd=1, col=alpha(2,.5), ylim=c(5500, 15500))
par(new=TRUE)
plot(unemp - signal(unemp_kfs6, "seasonal")$signal, ylab='', lwd=1, col=alpha(4,.5), ylim=c(5500, 15500))
title(main='Seasonal adjusted')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=1, alpha=c('black',.5))
library(scales)
unemp_ssm0 <- SSModel(unemp ~ SSMtrend(1, Q=list(NA)) + SSMseasonal(12, sea.type = 'dummy', Q=NA), H=NA)
unemp_fit0 <- fitSSM(unemp_ssm0, inits=c(1,1,1))
unemp_kfs0 <- KFS(unemp_fit0$model)
unemp_ssm6 <- SSModel(unemp ~ SSMtrend(1, Q=list(1.5)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=2)
unemp_kfs6 <- KFS(unemp_ssm6)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=1, col=alpha(1,.5))
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha(2,.5), lwd=1)
par(new=TRUE)
plot(signal(unemp_kfs6, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha(4,.5), lwd=1)
title(main='trend')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
plot(series(unemp_x11, "d11"), ylim=c(5500, 15500), ylab='', lwd=1, col=alpha(1,.5))
par(new=TRUE)
plot(unemp - signal(unemp_kfs0, "seasonal")$signal, ylab='', lwd=1, col=alpha(2,.5), ylim=c(5500, 15500))
par(new=TRUE)
plot(unemp - signal(unemp_kfs6, "seasonal")$signal, ylab='', lwd=1, col=alpha(4,.5), ylim=c(5500, 15500))
title(main='Seasonal adjusted')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
library(scales)
unemp_ssm0 <- SSModel(unemp ~ SSMtrend(1, Q=list(NA)) + SSMseasonal(12, sea.type = 'dummy', Q=NA), H=NA)
unemp_fit0 <- fitSSM(unemp_ssm0, inits=c(1,1,1))
unemp_kfs0 <- KFS(unemp_fit0$model)
unemp_ssm6 <- SSModel(unemp ~ SSMtrend(1, Q=list(1.5)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=2)
unemp_kfs6 <- KFS(unemp_ssm6)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=1, col=alpha('black',.5))
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha(2,.5), lwd=1)
par(new=TRUE)
plot(signal(unemp_kfs6, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha(4,.5), lwd=1)
title(main='trend')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
plot(series(unemp_x11, "d11"), ylim=c(5500, 15500), ylab='', lwd=1, col=alpha(1,.5))
par(new=TRUE)
plot(unemp - signal(unemp_kfs0, "seasonal")$signal, ylab='', lwd=1, col=alpha(2,.5), ylim=c(5500, 15500))
par(new=TRUE)
plot(unemp - signal(unemp_kfs6, "seasonal")$signal, ylab='', lwd=1, col=alpha(4,.5), ylim=c(5500, 15500))
title(main='Seasonal adjusted')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
library(scales)
unemp_ssm0 <- SSModel(unemp ~ SSMtrend(1, Q=list(NA)) + SSMseasonal(12, sea.type = 'dummy', Q=NA), H=NA)
unemp_fit0 <- fitSSM(unemp_ssm0, inits=c(1,1,1))
unemp_kfs0 <- KFS(unemp_fit0$model)
unemp_ssm6 <- SSModel(unemp ~ SSMtrend(1, Q=list(1.5)) + SSMseasonal(12, sea.type = 'dummy', Q=1), H=2)
unemp_kfs6 <- KFS(unemp_ssm6)
plot(series(unemp_x11, "d12"),ylim=c(5500, 15500), ylab='', lwd=1, col=alpha('black',.5))
par(new=TRUE)
plot(signal(unemp_kfs0, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha('red',.5), lwd=1)
par(new=TRUE)
plot(signal(unemp_kfs6, "trend")$signal, ylim=c(5500, 15500), ylab='',col=alpha('blue',.5), lwd=1)
title(main='trend')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
plot(series(unemp_x11, "d11"), ylim=c(5500, 15500), ylab='', lwd=1, col=alpha('black',.5))
par(new=TRUE)
plot(unemp - signal(unemp_kfs0, "seasonal")$signal, ylab='', lwd=1, col=alpha('red',.5), ylim=c(5500, 15500))
par(new=TRUE)
plot(unemp - signal(unemp_kfs6, "seasonal")$signal, ylab='', lwd=1, col=alpha('blue',.5), ylim=c(5500, 15500))
title(main='Seasonal adjusted')
legend('topleft', c('x11', 'MLE', 'Loss'), col=c(1,2,4), lty=1)
View(unemp_kfs0)
rm(list = ls())
setwd("C:/Users/GuoLY/desktop/markdown/2020 Winter/masterthesis")
load(file='.RData')
mleerrormat1 <- idemat1 - mlemat[c(1:100), ]
mleindex_good1 <- which(rowSums(abs(mleerrormat1)) <= 1) # 5: 19 45 48 54 57
mleindex_good2 <- which(rowSums(abs(mleerrormat1)) <= 2) # 21: 14 19 22 24 28 31 36 41 45 48 51 54 56 57 62 64 73 79 87 88 92
mleindex_good3 <- which(rowSums(abs(mleerrormat1)) <= 3) # 35: 7  9 14 19 22 24 25 27 28 29 31 35 36 41 45 48 49 51 54 55 56 57 62 64 66 67 73 76 79 82 87 88 92 96 97
mleindex_good1
mleindex_good2
mleindex_good3
tabl <- "  # simple table creation here
| Tables        | Are           | Cool  |
|---------------|:-------------:|------:|
| col 3 is      | right-aligned | $1600 |
| col 2 is      | centered      |   $12 |
| zebra stripes | are neat      |    $1 |
"
cat(tabl)
tabl <- "
| Tables        | Are           | Cool  |
|---------------|:-------------:|------:|
| col 3 is      | right-aligned | $1600 |
| col 2 is      | centered      |   $12 |
| zebra stripes | are neat      |    $1 |
"
cat(tabl)
